{% extends 'slots/base.html' %}
{% load static %}

{% block title %}Booking History - Cricket Slot Booking{% endblock %}

{% block content %}

<div class="container" style="padding-top: 90px;">

  <!-- HERO -->
  <div class="p-4 p-md-5 rounded-4 text-white shadow-sm mb-4"
       style="background: linear-gradient(135deg,#0B4F6C,#0A2540);">
    <div class="d-flex align-items-center gap-3">
      <div class="d-flex align-items-center justify-content-center rounded-4"
           style="width:56px;height:56px;background:rgba(255,255,255,.12);">
        <i class="fas fa-history fs-2" style="color:#F97316;"></i>
      </div>
      <div>
        <h1 class="h3 fw-bold mb-1">Booking History</h1>
        <p class="mb-0 opacity-75">Complete record of all your bookings</p>
      </div>
    </div>
  </div>

  <!-- STATS -->
  <div class="row g-3 mb-4">
    <div class="col-12 col-md-4">
      <div class="card border-0 shadow-sm rounded-4 h-100">
        <div class="card-body text-center py-4">
          <div class="text-muted fw-semibold small mb-1">Total Bookings</div>
          <div class="display-6 fw-bold text-primary mb-0">{{ total_bookings }}</div>
        </div>
      </div>
    </div>

    <div class="col-12 col-md-4">
      <div class="card border-0 shadow-sm rounded-4 h-100">
        <div class="card-body text-center py-4">
          <div class="text-muted fw-semibold small mb-1">Active Bookings</div>
          <div class="display-6 fw-bold text-success mb-0">{{ confirmed_bookings|length }}</div>
        </div>
      </div>
    </div>

    <div class="col-12 col-md-4">
      <div class="card border-0 shadow-sm rounded-4 h-100">
        <div class="card-body text-center py-4">
          <div class="text-muted fw-semibold small mb-1">Cancelled Bookings</div>
          <div class="display-6 fw-bold text-danger mb-0">{{ cancelled_bookings|length }}</div>
        </div>
      </div>
    </div>
  </div>

  <!-- ACTIVE BOOKINGS -->
  <div class="card border-0 shadow-sm rounded-4 mb-4">
    <div class="card-body p-4">
      <div class="d-flex align-items-center justify-content-between flex-wrap gap-2 mb-3">
        <h4 class="h5 fw-bold m-0" style="color:#0B4F6C;">
          <i class="fas fa-check-circle me-2 text-success"></i> Active Bookings
        </h4>
        <span class="text-muted small">Confirmed bookings</span>
      </div>

      {% if confirmed_bookings %}
        <div class="table-responsive">
          <table class="table table-hover table-striped align-middle mb-0">
            <thead class="table-light">
              <tr class="text-nowrap">
                <th class="ps-3">Date</th>
                <th>Time</th>
                <th>Type</th>
                <th>Booked On</th>
                <th class="text-end pe-3">Price</th>
              </tr>
            </thead>
            <tbody>
              {% for booking in confirmed_bookings %}
                <tr>
                  <td class="ps-3 fw-bold">{{ booking.slot.date|date:'d M Y' }}</td>
                  <td class="text-nowrap">{{ booking.slot.get_time_slot_display }}</td>
                  <td class="text-nowrap">
                    <span class="badge bg-primary-subtle text-primary rounded-pill px-3 py-2">
                      {{ booking.slot.get_cricket_type_display }}
                    </span>
                  </td>
                  <td class="text-nowrap text-muted">{{ booking.created_at|date:'d M Y H:i' }}</td>
                  <td class="text-end pe-3 fw-semibold">â‚¹{{ booking.slot.price }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <div class="text-center py-5">
          <div class="display-6 mb-2">âœ…</div>
          <h6 class="fw-bold mb-1">No active bookings</h6>
          <p class="text-muted mb-3">You donâ€™t have any confirmed bookings right now.</p>
          <a href="{% url 'slots:dashboard' %}" class="btn btn-primary btn-sm">
            <i class="fas fa-calendar-check me-2"></i> Book a Slot
          </a>
        </div>
      {% endif %}
    </div>
  </div>

  <!-- CANCELLED BOOKINGS -->
  <div class="card border-0 shadow-sm rounded-4">
    <div class="card-body p-4">
      <div class="d-flex align-items-center justify-content-between flex-wrap gap-2 mb-3">
        <h4 class="h5 fw-bold m-0" style="color:#0B4F6C;">
          <i class="fas fa-times-circle me-2 text-danger"></i> Cancelled Bookings
        </h4>
        <span class="text-muted small">Cancelled records</span>
      </div>

      {% if cancelled_bookings %}
        <div class="table-responsive">
          <table class="table table-hover table-striped align-middle mb-0">
            <thead class="table-light">
              <tr class="text-nowrap">
                <th class="ps-3">Date</th>
                <th>Time</th>
                <th>Type</th>
                <th>Booked On</th>
                <th>Cancelled On</th>
                <th class="text-end pe-3">Price</th>
              </tr>
            </thead>
            <tbody>
              {% for booking in cancelled_bookings %}
                <tr class="text-muted">
                  <td class="ps-3 fw-bold">{{ booking.slot.date|date:'d M Y' }}</td>
                  <td class="text-nowrap">{{ booking.slot.get_time_slot_display }}</td>
                  <td class="text-nowrap">
                    <span class="badge bg-secondary-subtle text-secondary rounded-pill px-3 py-2">
                      {{ booking.slot.get_cricket_type_display }}
                    </span>
                  </td>
                  <td class="text-nowrap">{{ booking.created_at|date:'d M Y H:i' }}</td>
                  <td class="text-nowrap">{{ booking.updated_at|date:'d M Y H:i' }}</td>
                  <td class="text-end pe-3 fw-semibold">â‚¹{{ booking.slot.price }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <div class="text-center py-5">
          <div class="display-6 mb-2">ðŸš«</div>
          <h6 class="fw-bold mb-1">No cancelled bookings</h6>
          <p class="text-muted mb-0">Great! You have no cancellations.</p>
        </div>
      {% endif %}
    </div>
  </div>

  <!-- BACK BUTTON -->
  <div class="d-flex justify-content-end mt-4">
    <a href="{% url 'slots:dashboard' %}" class="btn btn-primary">
      <i class="fas fa-arrow-left me-2"></i> Back to Dashboard
    </a>
  </div>

</div>

{% endblock %}
