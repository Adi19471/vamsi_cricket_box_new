{% extends 'slots/base.html' %}
{% load static %}

{% block title %}My Dashboard - Cricket Slot Booking{% endblock %}

{% block content %}

<!-- Page spacing for fixed navbar -->
<div class="container" style="padding-top: 90px;">

  <!-- HERO (Bootstrap only) -->
  <div class="p-4 p-md-5 rounded-4 text-white shadow-sm mb-4"
       style="background: linear-gradient(135deg,#0B4F6C,#0A2540);">
    <div class="d-flex align-items-center gap-3">
      <div class="d-flex align-items-center justify-content-center rounded-4"
           style="width:56px;height:56px;background:rgba(255,255,255,.12);">
        <i class="fas fa-user-circle fs-2" style="color:#F97316;"></i>
      </div>
      <div>
        <h1 class="h3 fw-bold mb-1">
          Welcome, {{ user.get_full_name|default:user.username }}!
        </h1>
        <p class="mb-0 opacity-75">Manage your bookings and explore available slots</p>
      </div>
    </div>
  </div>

  <!-- STATS (Bootstrap cards) -->
  <div class="row g-3 mb-4">
    <div class="col-6 col-md-3">
      <div class="card border-0 shadow-sm h-100 text-center rounded-4">
        <div class="card-body py-4">
          <i class="fas fa-ticket-alt fs-1 mb-2" style="color:#F97316;"></i>
          <div class="display-6 fw-bold mb-1" style="color:#0B4F6C;">
            {{ upcoming_bookings|length }}
          </div>
          <div class="text-muted fw-semibold small">Upcoming Bookings</div>
        </div>
      </div>
    </div>

    <div class="col-6 col-md-3">
      <div class="card border-0 shadow-sm h-100 text-center rounded-4">
        <div class="card-body py-4">
          <i class="fas fa-history fs-1 mb-2" style="color:#F97316;"></i>
          <div class="display-6 fw-bold mb-1" style="color:#0B4F6C;">
            {{ total_bookings }}
          </div>
          <div class="text-muted fw-semibold small">Total Bookings</div>
        </div>
      </div>
    </div>

    <div class="col-6 col-md-3">
      <div class="card border-0 shadow-sm h-100 text-center rounded-4">
        <div class="card-body py-4">
          <i class="fas fa-calendar-check fs-1 mb-2" style="color:#F97316;"></i>
          <div class="display-6 fw-bold mb-1" style="color:#0B4F6C;">
            {{ past_bookings|length }}
          </div>
          <div class="text-muted fw-semibold small">Past Matches</div>
        </div>
      </div>
    </div>

    <div class="col-6 col-md-3">
      <div class="card border-0 shadow-sm h-100 text-center rounded-4">
        <div class="card-body py-4">
          <i class="fas fa-wallet fs-1 mb-2" style="color:#F97316;"></i>
          <div class="display-6 fw-bold mb-1" style="color:#0B4F6C;">20%</div>
          <div class="text-muted fw-semibold small">Advance Payment</div>
        </div>
      </div>
    </div>
  </div>

  <div class="row g-4">

    <!-- LEFT -->
    <div class="col-lg-8">

      <!-- UPCOMING BOOKINGS -->
      <div class="card border-0 shadow-sm rounded-4 mb-4">
        <div class="card-body p-4">
          <div class="d-flex align-items-center justify-content-between flex-wrap gap-2 mb-3">
            <h4 class="h5 fw-bold m-0" style="color:#0B4F6C;">
              <i class="fas fa-calendar-alt me-2" style="color:#F97316;"></i> Upcoming Bookings
            </h4>
          </div>

          {% if upcoming_bookings %}
            <div class="d-grid gap-3">

              {% for booking in upcoming_bookings %}
                <div class="p-3 rounded-4 border bg-light d-flex align-items-start justify-content-between flex-wrap gap-3">
                  <!-- Left -->
                  <div class="d-flex align-items-center gap-3 flex-grow-1" style="min-width: 240px;">
                    <div class="d-flex align-items-center justify-content-center rounded-4 text-white"
                         style="width:54px;height:54px;background:linear-gradient(135deg,#0B4F6C,#0A2540);">
                      {% if booking.slot.cricket_type == 'box' %}
                        <i class="fas fa-square"></i>
                      {% else %}
                        <i class="fas fa-circle"></i>
                      {% endif %}
                    </div>

                    <div class="flex-grow-1">
                      <div class="fw-bold text-dark">
                        {{ booking.slot.get_cricket_type_display }} - {{ booking.slot.date|date:'d M Y' }}
                      </div>
                      <div class="text-muted small d-flex flex-wrap gap-3 mt-1">
                        <span><i class="fas fa-clock me-1" style="color:#F97316;"></i>{{ booking.slot.get_time_slot_display }}</span>
                        <span><i class="fas fa-users me-1" style="color:#F97316;"></i>{{ booking.slot.booked_count }}/{{ booking.slot.max_players }} players</span>
                      </div>
                    </div>
                  </div>

                  <!-- Right -->
                  <div class="d-flex align-items-center gap-2">
                    <span class="badge bg-success rounded-pill px-3 py-2">
                      <i class="fas fa-check-circle me-1"></i> Confirmed
                    </span>
                    <a href="#" class="btn btn-sm btn-outline-primary">
                      <i class="fas fa-eye me-1"></i> View
                    </a>
                  </div>
                </div>
              {% endfor %}

            </div>
          {% else %}
            <div class="text-center py-5">
              <div class="display-6 mb-2">ðŸ“…</div>
              <h5 class="fw-bold mb-2">No Upcoming Bookings</h5>
              <p class="text-muted mb-3">Browse available slots and book your next match!</p>
              <a href="{% url 'slots:dashboard' %}" class="btn btn-primary">
                <i class="fas fa-search me-2"></i> Browse Slots
              </a>
            </div>
          {% endif %}

        </div>
      </div>

      <!-- PAST BOOKINGS -->
      {% if past_bookings %}
      <div class="card border-0 shadow-sm rounded-4">
        <div class="card-body p-4">
          <h4 class="h5 fw-bold mb-3" style="color:#0B4F6C;">
            <i class="fas fa-history me-2" style="color:#F97316;"></i> Recent Past Bookings
          </h4>

          <div class="d-grid gap-3">
            {% for booking in past_bookings %}
              <div class="p-3 rounded-4 border bg-light d-flex align-items-start justify-content-between flex-wrap gap-3 opacity-75">
                <div class="d-flex align-items-center gap-3 flex-grow-1" style="min-width: 240px;">
                  <div class="d-flex align-items-center justify-content-center rounded-4 text-white"
                       style="width:54px;height:54px;background:linear-gradient(135deg,#64748B,#475569);">
                    <i class="fas fa-check"></i>
                  </div>

                  <div class="flex-grow-1">
                    <div class="fw-bold text-dark">
                      {{ booking.slot.get_cricket_type_display }} - {{ booking.slot.date|date:'d M Y' }}
                    </div>
                    <div class="text-muted small mt-1">
                      <i class="fas fa-clock me-1" style="color:#F97316;"></i>{{ booking.slot.get_time_slot_display }}
                      <span class="ms-2"><i class="fas fa-flag-checkered me-1" style="color:#F97316;"></i>Completed</span>
                    </div>
                  </div>
                </div>

                <div class="d-flex align-items-center gap-2">
                  <span class="badge bg-secondary rounded-pill px-3 py-2">
                    <i class="fas fa-check me-1"></i> Completed
                  </span>
                </div>
              </div>
            {% endfor %}
          </div>

        </div>
      </div>
      {% endif %}

    </div>

    <!-- RIGHT SIDEBAR -->
    <div class="col-lg-4">

      <!-- QUICK ACTIONS -->
      <div class="card border-0 shadow-sm rounded-4 mb-4">
        <div class="card-body p-4">
          <h4 class="h6 fw-bold mb-3" style="color:#0B4F6C;">
            <i class="fas fa-rocket me-2" style="color:#F97316;"></i> Quick Actions
          </h4>

          <div class="d-grid gap-2">
            <a href="{% url 'slots:dashboard' %}" class="btn btn-primary">
              <i class="fas fa-search me-2"></i> Browse Slots
            </a>
            <a href="{% url 'slots:my_bookings' %}" class="btn btn-outline-primary">
              <i class="fas fa-list me-2"></i> My Bookings
            </a>

            <div class="d-flex gap-2">
              <a href="{% url 'slots:booking_history' %}" class="btn btn-outline-secondary w-50">
                <i class="fas fa-history me-2"></i> History
              </a>
              <a href="{% url 'slots:venue' %}" class="btn btn-outline-secondary w-50">
                <i class="fas fa-info-circle me-2"></i> Venue
              </a>
            </div>
          </div>
        </div>
      </div>

      <!-- VENUE INFO -->
      <div class="card border-0 shadow-sm rounded-4 mb-4">
        <div class="card-body p-4">
          <h4 class="h6 fw-bold mb-3" style="color:#0B4F6C;">
            <i class="fas fa-map-marker-alt me-2" style="color:#F97316;"></i> Venue Info
          </h4>

          <ul class="list-group list-group-flush">
            <li class="list-group-item px-0">
              <div class="fw-bold"><i class="fas fa-clock me-2" style="color:#F97316;"></i>Timing</div>
              <div class="text-muted small ps-4">10am to 6pm</div>
            </li>

            <li class="list-group-item px-0">
              <div class="fw-bold"><i class="fas fa-tag me-2" style="color:#F97316;"></i>Weekday Price</div>
              <div class="text-muted small ps-4">â‚¹600/hr (20% advance)</div>
            </li>

            <li class="list-group-item px-0">
              <div class="fw-bold"><i class="fas fa-tag me-2" style="color:#F97316;"></i>Weekend Price</div>
              <div class="text-muted small ps-4">â‚¹700/hr (20% advance)</div>
            </li>

            <li class="list-group-item px-0">
              <div class="fw-bold"><i class="fas fa-envelope me-2" style="color:#F97316;"></i>Email</div>
              <div class="small ps-4">
                <a class="text-decoration-none" href="mailto:vamsibilla248@gmail.com">vamsibilla248@gmail.com</a>
              </div>
            </li>

            <li class="list-group-item px-0">
              <div class="fw-bold"><i class="fas fa-phone me-2" style="color:#F97316;"></i>Phone</div>
              <div class="small ps-4">
                <a class="text-decoration-none" href="tel:+917801019106">+91 7801019106</a>
              </div>
            </li>
          </ul>
        </div>
      </div>

      <!-- POLICIES -->
      <div class="card border-0 shadow-sm rounded-4">
        <div class="card-body p-4">
          <h4 class="h6 fw-bold mb-3" style="color:#0B4F6C;">
            <i class="fas fa-file-contract me-2" style="color:#F97316;"></i> Policies
          </h4>

          <div class="d-grid gap-3">
            <div class="d-flex gap-3">
              <i class="fas fa-money-bill-wave text-success fs-5"></i>
              <div>
                <div class="fw-bold">Payment</div>
                <div class="text-muted small">20% advance, balance on arrival</div>
              </div>
            </div>

            <div class="d-flex gap-3">
              <i class="fas fa-ban text-danger fs-5"></i>
              <div>
                <div class="fw-bold">Cancellation</div>
                <div class="text-muted small">No cancellation allowed</div>
              </div>
            </div>

            <div class="d-flex gap-3">
              <i class="fas fa-calendar-alt text-warning fs-5"></i>
              <div>
                <div class="fw-bold">Reschedule</div>
                <div class="text-muted small">No rescheduling allowed</div>
              </div>
            </div>
          </div>

        </div>
      </div>

    </div>

  </div>

</div>
{% endblock %}
